<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart City Lab - Issue Reporting System</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://cdn-icons-png.flaticon.com/512/3095/3095103.png" alt="Smart City" class="logo">
            <h1><i class="fas fa-city"></i> Smart City Lab</h1>
            <p class="subtitle">Report Infrastructure Issues - Build a Better City</p>
        </div>
        
        <div class="form-container">
            <h2><i class="fas fa-edit"></i> Report an Issue</h2>
            
            <form id="reportForm" method="POST">
                <div class="form-group">
                    <label for="city"><i class="fas fa-map-marker-alt"></i> City:</label>
                    <input type="text" id="city" name="city" required 
                           placeholder="e.g., Hyderabad, Mumbai, Delhi">
                </div>
                
                <div class="form-group">
                    <label for="area"><i class="fas fa-location-dot"></i> Area/Zone:</label>
                    <input type="text" id="area" name="area" required 
                           placeholder="e.g., Madhapur, Bandra, Connaught Place">
                </div>
                
                <div class="form-group">
                    <label for="street"><i class="fas fa-road"></i> Street/Location:</label>
                    <input type="text" id="street" name="street" required 
                           placeholder="e.g., Hitech City Road, MG Road">
                </div>
                
                <div class="form-group">
                    <label for="issue"><i class="fas fa-triangle-exclamation"></i> Issue Type:</label>
                    <select id="issue" name="issue" required>
                        <option value="">-- Select Issue Type --</option>
                        <option value="Broken Streetlight">üí° Broken Streetlight</option>
                        <option value="Pothole">üï≥Ô∏è Pothole on Road</option>
                        <option value="Garbage Overflow">üóëÔ∏è Garbage Overflow</option>
                        <option value="Water Leakage">üíß Water Leakage</option>
                        <option value="Traffic Signal Issue">üö¶ Traffic Signal Issue</option>
                        <option value="Damaged Footpath">üë£ Damaged Footpath</option>
                        <option value="Other">üîß Other Issue</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i> Your Email:</label>
                    <input type="email" id="email" name="email" required 
                           placeholder="you@example.com">
                    <small class="help-text">Confirmation will be sent to this email</small>
                </div>
                
                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> Submit Report
                </button>
            </form>
            
            <div id="message" class="message-area"></div>
            
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> What happens next?</h3>
                <ol>
                    <li>You'll receive a confirmation email with Reference ID</li>
                    <li>Smart City Lab team will verify your report</li>
                    <li>Sensor-based validation will be initiated</li>
                    <li>Issue will be resolved by concerned department</li>
                </ol>
                <p class="contact-info">
                    <i class="fas fa-headset"></i> Need help? 
                    <a href="mailto:kietsmartcitylab@gmail.com">kietsmartcitylab@gmail.com</a>
                </p>
            </div>
        </div>
        
        <div class="footer">
            <p>¬© 2023 Smart City Lab | Citizen Engagement Portal</p>
            <p class="stats" id="stats">Loading statistics...</p>
        </div>
    </div>

    <script>
        // Form submission
        document.getElementById('reportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = this;
            const submitBtn = form.querySelector('.submit-btn');
            const messageDiv = document.getElementById('message');
            
            // Disable button and show loading
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            submitBtn.disabled = true;
            
            // Clear previous messages
            messageDiv.innerHTML = '';
            messageDiv.className = 'message-area';
            
            try {
                const formData = new FormData(form);
                
                const response = await fetch('/submit', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success message
                    messageDiv.innerHTML = result.message;
                    messageDiv.className = 'message-area success';
                    
                    // Reset form
                    form.reset();
                    
                    // Update stats
                    updateStats();
                } else {
                    // Show error
                    messageDiv.innerHTML = `
                        <div class="error-box">
                            <h3><i class="fas fa-times-circle"></i> Submission Failed</h3>
                            <p>${result.error || 'Unknown error occurred'}</p>
                            <p>Please try again or contact support.</p>
                        </div>
                    `;
                    messageDiv.className = 'message-area error';
                }
            } catch (error) {
                messageDiv.innerHTML = `
                    <div class="error-box">
                        <h3><i class="fas fa-wifi-slash"></i> Network Error</h3>
                        <p>Please check your internet connection and try again.</p>
                    </div>
                `;
                messageDiv.className = 'message-area error';
            } finally {
                // Re-enable button
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Report';
                submitBtn.disabled = false;
            }
        });
        
        // Update stats
        async function updateStats() {
            try {
                const response = await fetch('/reports.json');
                const data = await response.json();
                document.getElementById('stats').textContent = 
                    `${data.count} issues reported | ${data.today} today`;
            } catch (error) {
                console.log('Could not load stats');
            }
        }
        
        // Load stats on page load
        window.onload = updateStats;
    </script>
</body>
</html>